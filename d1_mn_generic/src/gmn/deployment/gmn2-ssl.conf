<IfModule mod_ssl.c>
    ServerName gmn.example.edu

    WSGIPythonHome /var/local/dataone/gmn_venv

    define d1 /var/local/dataone
    
    define v1b ${d1}/gmn/bin
    define v2b ${d1}/gmn_venv/bin
    
    define v1p ${d1}/gmn/lib/python2.7/site-packages
    define v2p ${d1}/gmn_venv/lib/python2.7/site-packages
    
    define v1h ${v1p}/service
    define v2h ${v2p}/gmn
    
    define certs ${d1}/certs

    <VirtualHost *:443>
        ServerAdmin webmaster@localhost

        AllowEncodedSlashes NoDecode
        AcceptPathInfo On

        DocumentRoot /var/www

        <Directory />
            AllowOverride None
            Require all granted
        </Directory>

        LogLevel info ssl:warn

        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined

        SSLEngine on

        SSLCertificateFile      ${certs}/server/server_cert.pem
        SSLCertificateKeyFile   ${certs}/server/server_key_nopassword.pem
        #SSLCertificateChainFile ${certs}/server/server_intermediate.pem

        SSLCACertificatePath    ${certs}/ca
        #SSLCACertificateFile   ${certs}/ca/DataONECAChain.crt

        SSLVerifyClient optional
        SSLVerifyDepth  10

        <Files "wsgi.py">
            SSLOptions +ExportCertData
        </Files>

        WSGIScriptAlias /mn ${v2h}/wsgi.py
        WSGIDaemonProcess gmn2 user=gmn processes=2 threads=25 python-path=${v2p}
        WSGIProcessGroup gmn2

        <Directory ${v2h}>
            WSGIApplicationGroup %{GLOBAL}
            Require all granted
        </Directory>

        Alias /robots.txt ${v2h}/app/static/robots.txt
        Alias /static/ ${v2h}/app/static/
    </VirtualHost>
</IfModule>
