
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Using GMN &mdash; v1.0.0</title>
    
    <link rel="stylesheet" href="_static/dataone.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/sidebar.js"></script>
    <link rel="top" title="v1.0.0" href="index.html" />
    <link rel="next" title="Troubleshooting" href="troubleshooting.html" />
    <link rel="prev" title="Setting up testing and debugging environment for GMN" href="testing.html" />
   
  
  <link media="only screen and (max-device-width: 480px)" href="_static/small_dataone.css" type= "text/css" rel="stylesheet" />

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="troubleshooting.html" title="Troubleshooting"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="testing.html" title="Setting up testing and debugging environment for GMN"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html"></a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="using-gmn">
<h1>Using GMN<a class="headerlink" href="#using-gmn" title="Permalink to this headline">¶</a></h1>
<p>After <a class="reference internal" href="glossary.html#term-gmn"><em class="xref std std-term">GMN</em></a> has been set up according the setup instructions, it exposes
the complete REST interface that DataONE has defined for Member Nodes.
Currently, the easiest way to interact with GMN is to use the DataONE Command
Line Client (CLI). The CLI is installed automatically with GMN and can be
started by typing &#8220;dataone&#8221;. The CLI can also be scripted to perform tasks such
as bulk object creations to populate an instance of GMN with science data.</p>
<p>If more comprehensive access to the Node is required, DataONE provides libraries
in Java and Python that simplify the process of interacting with DataONE Member
Nodes and Coordinating Nodes. The libraries can be used as foundations for
custom applications that use the DataONE infrastructure.</p>
<div class="section" id="populating-your-new-node">
<h2>Populating your new Node<a class="headerlink" href="#populating-your-new-node" title="Permalink to this headline">¶</a></h2>
<p>The DataONE Client Library for Python includes an example on how to iterate over
a set of files, create data packages (resource maps) for them, and upload them
to a Member Node.</p>
</div>
<div class="section" id="permissions-for-create-update-and-delete">
<span id="id1"></span><h2>Permissions for create, update and delete<a class="headerlink" href="#permissions-for-create-update-and-delete" title="Permalink to this headline">¶</a></h2>
<p>DataONE does not specify how Member Nodes should control access to the APIs
that allow users to create, update and delete contents on the node. GMN controls
the access to these APIs with a whitelist. If a subject that is not in the
whitelist attempts to call, for instance, <tt class="docutils literal"><span class="pre">MNStorage.create()</span></tt>, GMN will
return a DataONE exception such as this (formatted for readability):</p>
<div class="highlight-none"><div class="highlight"><pre>Exception: NotAuthorized
errorCode: 401
detailCode: 0
description:
  Access allowed only for subjects with Create/Update/Delete permission.
  Active subjects:
    authenticatedUser (equivalent),
    public (equivalent),
    CN=First Last,O=Google,C=US,DC=cilogon,DC=org (primary)
</pre></div>
</div>
<p>This means that the connection was made with a certificate in which the subject
(the DataONE compliant serialization of the certificate DN) was <tt class="docutils literal"><span class="pre">CN=First</span>
<span class="pre">Last,O=Google,C=US,DC=cilogon,DC=org</span></tt> and that this subject was not in GMNs
whitelist for create, update and delete.</p>
<p>To create a whitelist with this subject, first create a file, for instance,
<tt class="docutils literal"><span class="pre">whitelist.txt</span></tt>. The most convenient location for this file is in the
<tt class="docutils literal"><span class="pre">service</span></tt> folder:</p>
<div class="highlight-none"><div class="highlight"><pre>$ su gmn
$ cd /var/local/dataone/gmn/lib/python2.6/site-packages/service
$ pico whitelist.txt
</pre></div>
</div>
<p>In this file, add a line with an exact copy of the subject string marked as
<tt class="docutils literal"><span class="pre">primary</span></tt> in the NotAuthorized exception (<tt class="docutils literal"><span class="pre">CN=First</span>
<span class="pre">Last,O=Google,C=US,DC=cilogon,DC=org</span></tt> in this case).</p>
<p>Blank lines and lines starting with &#8220;#&#8221; are ignored in the whitelist file,
allowing comments. The remaining lines must each contain a separate subject.</p>
<p>Then, add the entries in the whitelist text file to GMNs database with the
following command:</p>
<div class="highlight-none"><div class="highlight"><pre>$ python manage.py set_whitelist_for_create_update_delete whitelist.txt
</pre></div>
</div>
<p>Any existing subjects in the database are cleared before adding the subjects
from the whitelist file. So subjects can be added or removed from the whitelist
by adding or removing them in the file and then synchronized with the database
by running the command above.</p>
</div>
<div class="section" id="authenticating-to-your-node">
<h2>Authenticating to your Node<a class="headerlink" href="#authenticating-to-your-node" title="Permalink to this headline">¶</a></h2>
<p>To authenticate to your Node, you must connect over HTTPS and provide a
certificate. The certificate must be issued by CILogon or DataONE (the two CAs
that a Member Node trusts by default). In addition, the certificate must be for
a subject that has the rights required for performing the operation(s) the
client intends to perform after connecting. For instance, GMN requires that the
subject used in connections that create content on the Node validate against an
internal whitelist.</p>
<p>When running operations against the Node as a regular user, it is natural to use
a certificate obtained from CILogon. CILogon provides certificates that are
secured by a having a time limit of 18 hours.</p>
<p>However, when running an automated task, such as a task that connects to the
Node once a day and creates new objects, the CILogon certificate is not a good
fit, as someone would have to manually update the certificate every day. There
are two basic ways to resolve this:</p>
<p>1) Use the certificate that was issued to the Node by DataONE. GMN automatically
trusts this certificate. However, there are security implications to this.
Anyone that gains access to this certificate can access all the content on your
Node and can act as your Node in the DataONE infrastructure. So, it&#8217;s best to
only use this approach when running the automated tasks on the same server on
which GMN runs, or from another tightly controlled server. To use the DataONE
issued certificate in local connections, simply provide the paths to the
certificate and its private key in <tt class="docutils literal"><span class="pre">/var/local/dataone/certs/client</span></tt> when
creating a Member Node client in script.</p>
<p>2) Set up a local CA. This is the only option if the Node has been set up as a
<a class="reference internal" href="setup-local.html"><em>stand-alone test instance</em></a>. This CA is then added to the CAs
trusted by GMN and used for issuing one or more certificates, which are then
used by the automated processes. This is the most secure solution as
certificates issued by your local CA cannot be used for representing you in the
DataONE infrastructure, should your local CA be compromised. See
<a class="reference internal" href="setup-local-ca.html"><em>Setting up a local CA</em></a> for instructions on how to set this up.</p>
<div class="section" id="authenticating-without-a-certificate">
<h3>Authenticating without a certificate<a class="headerlink" href="#authenticating-without-a-certificate" title="Permalink to this headline">¶</a></h3>
<p>In a stand-alone testing environment, where network access to the GMN instance
is strictly limited, it is possible to simply add <tt class="docutils literal"><span class="pre">public</span></tt> to the
<a class="reference internal" href="#permissions-for-create-update-and-delete"><em>whitelist for create, update and delete</em></a>. Because the public subject is
assigned to all connections, this allows access to create, update and delete
objects on the node without any authentication.</p>
<p>Thus, this mode allows modifying node contents when connecting entirely without
a certificate. It also lets GMN be set up for access over regular HTTP.</p>
</div>
<div class="section" id="authenticating-with-any-trusted-certificate">
<h3>Authenticating with any trusted certificate<a class="headerlink" href="#authenticating-with-any-trusted-certificate" title="Permalink to this headline">¶</a></h3>
<p>Connections that are made with any certificate that is trusted by GMN are
assigned the <cite>authenticatedUser</cite> subject. So, adding this subject to the
<a class="reference internal" href="#permissions-for-create-update-and-delete"><em>whitelist for create, update and delete</em></a> enables anyone that connects with a
trusted certificate to alter content on the Node. This is highly insecure if
the Node is set up to trust CILogon, as anyone can obtain a CILogon certificate
through OpenID. However, it may be useful if the node exposes only public
objects and so, does not need to trust CILogon.</p>
</div>
</div>
<div class="section" id="vendor-specific-extensions">
<h2>Vendor specific extensions<a class="headerlink" href="#vendor-specific-extensions" title="Permalink to this headline">¶</a></h2>
<p>GMN implements a set of extensions that enhance the functionality of GMN. Most
of these are designed to help with debugging and profiling and they are
described in another section.</p>
<div class="section" id="remote-url">
<h3>Remote URL<a class="headerlink" href="#remote-url" title="Permalink to this headline">¶</a></h3>
<p>The Remote URL vendor specific extension enables GMN to be used for exposing
science data that is already available through another web based service without
having to create another copy of that data.</p>
<p>In the regular create() and update() REST calls, the bytes of the science
objects are provided, and the MN manages the storage of the science objects.
When using the Remote URL extension, the bytes of the objects are not provided
and instead, a HTTP or HTTPS URL to the original location of the data is
provided. GMN then manages all aspects of exposing the science data except for
the actual storage of the bytes of the exposed object.</p>
<p>When the object is downloaded from GMN, GMN streams the object from its original
location in the background.</p>
<p>This extension is activated by added an HTTP header to the REST call for
create() and update(). The name of the header is VENDOR_GMN_REMOTE_URL and the
value is the HTTP or HTTPS URL that references the object in the remote
location.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/dataone_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Using GMN</a><ul>
<li><a class="reference internal" href="#populating-your-new-node">Populating your new Node</a></li>
<li><a class="reference internal" href="#permissions-for-create-update-and-delete">Permissions for create, update and delete</a></li>
<li><a class="reference internal" href="#authenticating-to-your-node">Authenticating to your Node</a><ul>
<li><a class="reference internal" href="#authenticating-without-a-certificate">Authenticating without a certificate</a></li>
<li><a class="reference internal" href="#authenticating-with-any-trusted-certificate">Authenticating with any trusted certificate</a></li>
</ul>
</li>
<li><a class="reference internal" href="#vendor-specific-extensions">Vendor specific extensions</a><ul>
<li><a class="reference internal" href="#remote-url">Remote URL</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation Overview</a><ul>
      <li>Previous: <a href="testing.html" title="previous chapter">Setting up testing and debugging environment for GMN</a></li>
      <li>Next: <a href="troubleshooting.html" title="next chapter">Troubleshooting</a></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

    <div class="footer">
      &copy; Copyright <a href="http:/www.dataone.org">2010-2012 Participating institutions in DataONE</a>.
        [ <a href="_sources/use.txt"
               rel="nofollow">Page Source</a> | 
          <a href='https://redmine.dataone.org/projects/d1/repository/changes/documents/Projects/cicore/architecture/api-documentation/source/use.txt'
            rel="nofollow">Revision History</a> ]&nbsp;&nbsp;
    </div>
    <!--
    <hr />
     <div id="HCB_comment_box"><a href="http://www.htmlcommentbox.com">HTML Comment Box</a> is loading comments...</div>
     <link rel="stylesheet" type="text/css" href="_static/skin.css" />
     <script type="text/javascript" language="javascript" id="hcb"> 
     /*<! -*/ 
     (function()
     {s=document.createElement("script");
     s.setAttribute("type","text/javascript");
     s.setAttribute("src", "http://www.htmlcommentbox.com/jread?page="+escape((typeof hcb_user !== "undefined" && hcb_user.PAGE)||(""+window.location)).replace("+","%2B")+"&mod=%241%24wq1rdBcg%24Gg8J5iYSHJWwAJtlYu/yU."+"&opts=21407&num=10");
     if (typeof s!="undefined") document.getElementsByTagName("head")[0].appendChild(s);})();
      /* ->*/ 
     </script>
   -->
  </body>
</html>